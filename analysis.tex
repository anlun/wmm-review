\section{Analysis}

In this section we present the detailed comparison 
of the considered programming language memory models. 

We summarize our findings in \cref{table:summary}. 
Each row of the table corresponds to a memory model, denoted by its abbreviation. 
The correspondence between the memory model abbrevation, 
its full name and the research papers is given in \cref{table:mmodels}.
Columns of the table correspond to properties of the models. 
We split the properties into several subgroups. 

The first group is devoted to optimality of compilation mappings
to target hardware instructions. In order to be concise, 
we chose the binary classification of optimality, 
that is we classify the compilation scheme as either optimal or not,
in the following sense.
We chose the weakest possible access mode supported by the model
and consider the compilation scheme for the memory accesses annotated by this mode. 
However, for the memory models that treat racy non-atomic accesses
as undefined behavior, we consider the compilation mapping
for relaxed accesses (or stronger, in case when the model does not support relaxed atomics).  
This is because the catch-fire semantics for racy non-atomics 
trivially permits the most optimal compilation mappings (see \cref{sec:bgrnd-ub}).
We say that compilation scheme is optimal if the accesses annotated by the chosen mode 
can be compiled as plain load and store instructions of the given hardware architecture. 

The second group is dedicated to soundness of various program transformations. 
The classification is also binary: a transformation is either sound or unsound 
in the given memory model (in a sense stated in \cref{sec:bgrnd-opt-sound}).
Again, to be concise, we do not consider all the combinations 
of program tranformations and memory access modes. 
Instead, we consider the weakest possible accesses which have fully defined semantics. 
We further split the transformations into global and local as in \cref{sec:bgrnd-opt-sound}.

The third group corresponds to reasoning principles guaranteed by the model. 
It includes the following properties. What kind of DRF guarantee the model provides.
(we distinguish the internal, external and local DRF theorems, see \cref{sec:bgrnd-drf}).
Whether the model has undefined behaviors (see \cref{sec:bgrnd-ub}).
Whether the model permits out-of-thin-air values (see \cref{sec:bgrnd-oota}).

Finally, the last group enumerates the list of memory access modes 
and fences supported by the model, as well as whether the model 
supports read-modify-write operations, locks, and mixed-size accesses.

Driven by our analysis of the models' properties, we partition all models into five classes. 
The models from the same class have similar compilation mappings, 
set of sound program transformations, and provided reasoning guarantees.
Our classes are ordered by the weakness of the memory models they consist of.  
The strongest models are located at the top rows of the table, 
while the weakest are at the bottom. 

We next discuss each class in more details
(note that the order is different from the one in the \cref{table:summary}). 
We also give some insight on the relationship
between compilation scheme optimality, 
soundness of transformations and reasoning guarantees.
In particular, we explain why the support of some reasoning guarantees 
disables some program transformations and requires more heavyweight 
compilation mappings to hardware.

\subsection{Strong SC-like Models}

\begin{itemize}
  \item Pros.
  \begin{itemize}
    \item Simplicity
    \item DRF-SC for free
    \item Coherence for free
  \end{itemize}
  \item Cons.
  \begin{itemize}
    \item Compilation to hardware is expensive.
    \item Many transformations are unsound.
    \begin{itemize}
      \item reorderings
      \item CSE
      \item what else...?
    \end{itemize}
  \end{itemize}
\end{itemize}

\subsection{Strong TSO-like Models}

\begin{itemize}
  \item Pros.
  \begin{itemize}
    \item optimal compilation to x86
    \item Coherence for free
  \end{itemize}
  \item Cons.
  \begin{itemize}
    \item Compilation to hardware weaker hardware is expensive.
    \item Load/Store reorderings unsound.
    \item Thread inlining unsound (?)
  \end{itemize}
\end{itemize}

\subsection{OOTA Models}

\begin{itemize}
  \item Pros.
  \begin{itemize}
    \item Cheap compilation to hardware.
    \item Almost all transformations are sound. 
  \end{itemize}
  \item Cons.
  \begin{itemize}
    \item No external DRF (only internal).
  \end{itemize}
\end{itemize}

\subsection{$\lPO\cup\lRF$ Acyclic Models}

\begin{itemize}
  \item Pros.
  \begin{itemize}
    \item Many desired transformations are sound. 
    \item Simple solution to forbid OOTA.
  \end{itemize}
  \item Cons.
  \begin{itemize}
    \item Compilation to ARM and POWER is still not optimal.
    \item Load/Store reordering is still unsound.
  \end{itemize}
\end{itemize}

\subsection{$\lPPO\cup\lRF$ Acyclic Models}

\begin{itemize}
  \item Pros.
  \begin{itemize}
    \item (?)
  \end{itemize}
  \item Cons.
  \begin{itemize}
    \item Trace preserving transformations are unsound.
  \end{itemize}
\end{itemize}

\subsection{no-OOTA Models}

\begin{itemize}
  \item Pros.
  \begin{itemize}
    \item Cheap compilation to hardware.
    \item Almost all transformations are sound (including all reorderings). 
  \end{itemize}
  \item Cons.
  \begin{itemize}
    \item Complexity.
    \item No common ground between various models.
    \item It's unknown how to make thread inlining sound (?).
  \end{itemize}
\end{itemize}

\newpage
\onecolumn

\begin{landscape}

\begin{table*}
\begin{tabular}{|c|l|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|}
 \hline

                                                      &
 \multirow{3}{*}{Model}                               & 
 \multicolumn{ 4}{c|}{\multirow{2}{*}{Compilation}}   &
 \multicolumn{10}{c|}{Transformations}                &
 \multicolumn{ 6}{c|}{Reasoning}                      &
 \multicolumn{ 9}{c|}{\multirow{2}{*}{Features}}      \\ 

 \cline{7-22}

                             &
                             &
 \multicolumn{4}{c|}{}       &
 \multicolumn{7}{c|}{Local}  &
 \multicolumn{3}{c|}{Global} &

 \multicolumn{3}{c|}{DRF}    &
 \multicolumn{3}{c|}{}       &
 \multicolumn{9}{c|}{}       \\ 
 
 \hline
                                     &
                                     &
 \rotatebox[origin=c]{270}{x86}      & 
 \rotatebox[origin=c]{270}{Power}    & 
 \rotatebox[origin=c]{270}{ARMv7}    & 
 \rotatebox[origin=c]{270}{ARMv8}    & 
 
 \rotatebox[origin=c]{270}{TP}     &
 \rotatebox[origin=c]{270}{RI}     &
 \rotatebox[origin=c]{270}{RE}     &
 \rotatebox[origin=c]{270}{ILE}    &
 \rotatebox[origin=c]{270}{SLI}    &
 \rotatebox[origin=c]{270}{S}      &
 \rotatebox[origin=c]{270}{RM}     &
 \rotatebox[origin=c]{270}{RP}     &
 \rotatebox[origin=c]{270}{VR}     &
 \rotatebox[origin=c]{270}{TI}     &
 
 \rotatebox[origin=c]{270}{Int}    &
 \rotatebox[origin=c]{270}{Ext}    &
 \rotatebox[origin=c]{270}{Loc}    &

 \rotatebox[origin=c]{270}{UB}                                 &
 \rotatebox[origin=c]{270}{\makecell{$\lPO\cup\lRF$ \\ acyc.}} & 
 \rotatebox[origin=c]{270}{OOTA}                               &                              


 \rotatebox[origin=c]{270}{NA}                      &
 \rotatebox[origin=c]{270}{RLX}                     &
 \rotatebox[origin=c]{270}{RA}                      &
 \rotatebox[origin=c]{270}{SC}                      &
 \rotatebox[origin=c]{270}{F-RA}                    &
 \rotatebox[origin=c]{270}{F-SC}                    &
 \rotatebox[origin=c]{270}{RMW}                     &
 \rotatebox[origin=c]{270}{Lock}                    &
 \rotatebox[origin=c]{270}{\makecell{Mix.Sz.}}      \\ 
 
 \Xhline{2\arrayrulewidth}
 
 \multirow{3}{*}{\rotatebox[origin=c]{270}{\makecell{SeqCst}}}   

 & SC             & & & & & & & & & & & & & & & & & & & & & & & & & & & & & \\ \cline{2-31}
 & SC-Haskell     & & & & & & & & & & & & & & & & & & & & & & & & & & & & & \\ \cline{2-31}
 & DRFx           & & & & & & & & & & & & & & & & & & & & & & & & & & & & & \\ \Xhline{2\arrayrulewidth}

 \multirow{2}{*}{\rotatebox[origin=c]{270}{\makecell{TSO\\PSO}}}   

 & BMM            & & & & & & & & & & & & & & & & & & & & & & & & & & & & & \\ \cline{2-31}

 & Rlx Op.Sem.    & & & & & & & & & & & & & & & & & & & & & & & & & & & & & \\ \Xhline{2\arrayrulewidth}

 \multirow{5}{*}{\rotatebox[origin=c]{270}{\makecell{$\lPO\lRF$\\acyc}}}   

 & RC11           & & & & & & & & & & & & & & & & & & & & & & & & & & & & & \\ \cline{2-31}

 & ORC11          & & & & & & & & & & & & & & & & & & & & & & & & & & & & & \\ \cline{2-31}

 & OCaml MM       & & & & & & & & & & & & & & & & & & & & & & & & & & & & & \\ \cline{2-31}

 & JAM            & & & & & & & & & & & & & & & & & & & & & & & & & & & & & \\ \cline{2-31}

 & Rlx Compos.    & & & & & & & & & & & & & & & & & & & & & & & & & & & & & \\ \Xhline{2\arrayrulewidth}

 \multirow{2}{*}{\rotatebox[origin=c]{270}{\makecell{$\lPPO\lRF$\\acyc}}}   

 & LKMM           & & & & & & & & & & & & & & & & & & & & & & & & & & & & & \\ \cline{2-31}

 & OHMM           & & & & & & & & & & & & & & & & & & & & & & & & & & & & & \\ \Xhline{2\arrayrulewidth}

 \multirow{7}{*}{\rotatebox[origin=c]{270}{\makecell{no-OOTA}}}   

 & JMM            & & & & & & & & & & & & & & & & & & & & & & & & & & & & & \\ \cline{2-31}

 & Promising      & & & & & & & & & & & & & & & & & & & & & & & & & & & & & \\ \cline{2-31}

 & Weakestmo      & & & & & & & & & & & & & & & & & & & & & & & & & & & & & \\ \cline{2-31}

 & MRD            & & & & & & & & & & & & & & & & & & & & & & & & & & & & & \\ \cline{2-31}

 & P-P/S          & & & & & & & & & & & & & & & & & & & & & & & & & & & & & \\ \cline{2-31}

 & J/R            & & & & & & & & & & & & & & & & & & & & & & & & & & & & & \\ \cline{2-31}

 & Generative     & & & & & & & & & & & & & & & & & & & & & & & & & & & & & \\ \Xhline{2\arrayrulewidth}

 \multirow{5}{*}{\rotatebox[origin=c]{270}{\makecell{OOTA}}}   

 & C11            & & & & & & & & & & & & & & & & & & & & & & & & & & & & & \\ \cline{2-31}

 & JS MM          & & & & & & & & & & & & & & & & & & & & & & & & & & & & & \\ \cline{2-31}

 & RMC            & & & & & & & & & & & & & & & & & & & & & & & & & & & & & \\ \cline{2-31}

 & RAO            & & & & & & & & & & & & & & & & & & & & & & & & & & & & & \\ \cline{2-31}

 & Spec.Comp.     & & & & & & & & & & & & & & & & & & & & & & & & & & & & & \\ \Xhline{2\arrayrulewidth}


\end{tabular}
\caption{
  % \textit{T.P.} --- trace preserving.
  % \textit{R.I.} --- reordering of independent instructions.
  % \textit{R.E.} --- redundunt load/store elimination.
  % \textit{I.L.E.} --- irrelevant load elimination.
  % \textit{S.L.I.} --- speculative load introduction.
  % \textit{S.} --- strengthening.
  % \textit{R.M.} --- roach motel reordering.
  % \textit{R.P.} --- register promotion.
  % \textit{V.R.} --- value range analysis based optimizations.
  % \textit{T.I.} --- thread inlining (sequentialization).
  % \textit{Int.} --- internal.
  % \textit{Ext.} --- external.
  % \textit{Loc.} --- local.
  % \textit{UB} --- undefined behavior.
  % \textit{OOTA} --- out-of-thin air values.
  % \textit{Mix.Sz.} --- mixed-size accesses.
}
\label{table:summary}
\end{table*}

\end{landscape}

\twocolumn